<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ¬∑ CodePedia</title>
  <link rel="stylesheet" href="css/common.css"/>
  <style>
    .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
    @media(max-width: 1100px){ .grid{ grid-template-columns: repeat(2,1fr); } }
    @media(max-width: 620px){ .grid{ grid-template-columns: 1fr; } }
    .kpi { text-align:left; }
    .kpi h1{ margin:0; font-size:42px }
    .heat { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; }
    .cell { height:22px; border-radius:6px; border:1px solid var(--border); background:#fff }
    .cell.on { background:#c7f9cc; border-color:#8de4a1 }
    .bar { height:12px; border-radius:8px; background: linear-gradient(90deg, var(--brand), var(--brand-2)); }
    .row { display:flex; align-items:center; gap:10px }
    .row .label{ width:160px; color: var(--muted) }
    .muted-sm{ color: var(--muted); font-size: 12px }
  </style>
</head>
<body>
  <div id="appHeader"></div>
  <div id="appSidebar"></div>

  <main class="container">
    <section class="card">
      <h2>üìä –°—ñ–∑–¥—ñ“£ –ø—Ä–æ–≥—Ä–µ—Å—Å —Ç—É—Ä–∞–ª—ã –∞“õ–ø–∞—Ä–∞—Ç</h2>

      <div class="grid">
        <div class="card kpi">
          <div class="muted-sm">–ñ–∞–ª–ø—ã –∫—ñ—Ä–≥–µ–Ω –∫“Ø–Ω–¥–µ—Ä</div>
          <h1 id="kpiDays">‚Äî</h1>
        </div>

        <div class="card kpi">
          <div class="muted-sm">–û“õ—ã“ì–∞–Ω —Å–∞–±–∞“õ —Å–∞–Ω—ã</div>
          <h1 id="kpiStreak">‚Äî</h1>
        </div>

        <div class="card kpi">
          <div class="muted-sm">–û–ª–∏–º–ø–∏–∞–¥–∞ –µ—Å–µ–ø—Ç–µ—Ä—ñ </div>
          <h1 id="kpiSolved">‚Äî</h1>
        </div>

        <div class="card kpi">
          <div class="muted-sm">–°–∞–±–∞“õ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ (‚â•80%)</div>
          <!-- “Æ–ª–∫–µ–Ω —Å–∞–Ω: ”©—Ç–∫–µ–Ω —Ç–µ—Å—Ç—Ç–µ—Ä —Å–∞–Ω—ã -->
          <h1 id="kpiLessons">‚Äî</h1>
          <!-- –ï–≥–∂–µ–π: –æ—Ä—Ç–∞—à–∞ % –∂”ô–Ω–µ –µ—Å–µ–ø—Ç–µ–ª–≥–µ–Ω —Ç–µ—Å—Ç—Ç–µ—Ä —Å–∞–Ω—ã -->
          <div style="font-size:22px; font-weight:700">
            –û—Ä—Ç–∞—à–∞ –±–∞–ª–ª: <span id="kpiLessonsAvg">0</span>% 
            <span class="muted" style="font-size:14px"> ¬∑ ”®—Ç–∫–µ–Ω —Ç–µ—Å—Ç—Ç–µ—Ä: <span id="kpiLessonsCount">0</span></span>
          </div>
        </div>
      </div>
    </section>

    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>–ñ—ã–ª–¥—ã“õ –∫–∞–ª–µ–Ω–¥–∞—Ä—å</h3>
        <div><select id="monthSel" class="pill"></select></div>
      </div>
      <div id="calendar" class="heat" style="margin-top:12px"></div>
      <div class="muted-sm">–ñ–∞—Å—ã–ª “±—è—à—ã“õ ‚Äî —Å–æ–ª –∫“Ø–Ω—ñ —Å–∞–π—Ç“õ–∞ –∫—ñ—Ä–≥–µ–Ω.</div>
    </section>

    <section class="card">
      <h3>“ö—ã—Å“õ–∞—à–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
      <div class="row"><div class="label">–ê—Ä–µ–Ω–∞ ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Ä—ñ</div><div style="flex:1"><div id="bar-attempts" class="bar"></div></div></div>
      <div class="row"><div class="label">–ê—Ä–µ–Ω–∞ —à–µ—à—ñ–º–¥–µ—Ä—ñ</div><div style="flex:1"><div id="bar-solved" class="bar"></div></div></div>
    </section>
  </main>

  <script src="js/header.js"></script>
  <script src="js/sidebar.js"></script>
  <script src="js/guard.js"></script>
  <script src="js/telemetry.js"></script>
  <script>
    renderHeader(); renderSidebar();

    // Telemetry-–¥—ñ “õ–∞–π—Ç–∞ –∞–≥—Ä–µ–≥–∞—Ç—Ç–∞–π–º—ã–∑ (—Å–æ“£“ì—ã –º”ô–Ω–¥–µ—Ä)
    const fresh = Telemetry.aggregate();
    const s = Telemetry.getStats() || fresh;

    // KPI
    const daysCount = Object.keys(s.visitsByDay || {}).length;
    document.getElementById('kpiDays').textContent    = daysCount;
    document.getElementById('kpiStreak').textContent  = s.streak || 0;
    document.getElementById('kpiSolved').textContent  = s.arenaSolved || 0;

    // –°–∞–±–∞“õ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ (‚â•80): “Ø–ª–∫–µ–Ω —Å–∞–Ω, –æ—Ä—Ç–∞—à–∞ %, —Å–∞–Ω—ã
    document.getElementById('kpiLessons').textContent     = s.lessonsPassed || 0;
    document.getElementById('kpiLessonsAvg').textContent  = s.lessonsAvgScore || 0;
    document.getElementById('kpiLessonsCount').textContent= s.lessonsPassed || 0;

    // Bars (–ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º–µ–Ω, max=100%)
    function pct(v){ return Math.min(100, (v || 0) * 10); }
    document.getElementById('bar-attempts').style.width = pct(s.arenaAttempts) + '%';
    document.getElementById('bar-solved').style.width   = pct(s.arenaSolved)   + '%';

    // Month selector
    const monthSel = document.getElementById('monthSel');
    const months = ['“ö–∞“£—Ç–∞—Ä','–ê“õ–ø–∞–Ω','–ù–∞—É—Ä—ã–∑','–°”ô—É—ñ—Ä','–ú–∞–º—ã—Ä','–ú–∞—É—Å—ã–º','–®—ñ–ª–¥–µ','–¢–∞–º—ã–∑','“ö—ã—Ä–∫“Ø–π–µ–∫','“ö–∞–∑–∞–Ω','“ö–∞—Ä–∞—à–∞','–ñ–µ–ª—Ç–æ“õ—Å–∞–Ω'];
    const now = new Date();
    months.forEach((m,i)=> {
      const o = document.createElement('option');
      o.value = (i+1).toString().padStart(2,'0');
      o.textContent = m;
      if (i === now.getMonth()) o.selected = true;
      monthSel.appendChild(o);
    });

    function renderMonth() {
      const m = monthSel.value;
      const y = now.getFullYear();
      const d = new Date(y, parseInt(m), 0).getDate(); // days in month
      const grid = document.getElementById('calendar'); grid.innerHTML = '';
      const map = s.visitsByDay || {};
      for (let day=1; day<=d; day++) {
        const key = `${y}-${m}-${String(day).padStart(2,'0')}`;
        const cell = document.createElement('div');
        cell.className = 'cell' + (map[key] ? ' on' : '');
        cell.title = key + (map[key] ? ' ¬∑ –∫—ñ—Ä–≥–µ–Ω' : '');
        grid.appendChild(cell);
      }
    }
    monthSel.onchange = renderMonth;
    renderMonth();
  </script>
</body>
</html>
