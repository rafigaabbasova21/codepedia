<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Python Tug-of-War Quiz</title>
  <style>
    :root{
      --bg1:#e9f4ff;
      --bg2:#f7fbff;
      --card:#ffffff;
      --shadow: 0 18px 40px rgba(2, 6, 23, .12);
      --text:#0f172a;
      --muted:#64748b;
      --blue:#2563eb;
      --cyan:#06b6d4;
      --red:#ef4444;
      --green:#22c55e;
      --radius:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      background: radial-gradient(1200px 600px at 50% 35%, var(--bg1), var(--bg2));
      display:flex;
      flex-direction:column;
    }
    header{
      position:sticky; top:0;
      backdrop-filter: blur(10px);
      background: rgba(255,255,255,.55);
      border-bottom: 1px solid rgba(15,23,42,.08);
      z-index:5;
    }
    .topbar{
      max-width:1200px;
      margin:0 auto;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .logo{
      width:34px;height:34px;border-radius:12px;
      background: linear-gradient(135deg, var(--blue), var(--cyan));
      box-shadow: 0 10px 20px rgba(37,99,235,.25);
    }
    .pill{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      color:var(--muted); font-size:14px;
    }
    .pill b{color:var(--text)}
    .btn{
      border:0;
      border-radius: 999px;
      padding:10px 14px;
      font-weight:700;
      cursor:pointer;
      background: linear-gradient(135deg, var(--blue), var(--cyan));
      color:white;
      box-shadow: 0 12px 24px rgba(37,99,235,.25);
      transition:.15s transform;
    }
    .btn:active{transform: translateY(1px) scale(.99)}
    .btn.secondary{
      background:white; color:var(--text);
      border:1px solid rgba(15,23,42,.12);
      box-shadow:none;
    }

    main{
      flex:1;
      max-width:1200px;
      margin:0 auto;
      padding:18px 16px 28px;
      display:grid;
      grid-template-columns: 360px 1fr 360px;
      gap:18px;
      align-items:stretch;
    }
    @media (max-width: 1100px){
      main{grid-template-columns: 1fr; }
    }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
      border:1px solid rgba(15,23,42,.08);
    }

    /* Center arena */
    .arena{
      display:flex;
      flex-direction:column;
      gap:14px;
      justify-content:space-between;
    }
    .arenaTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      flex-wrap:wrap;
    }
    .badge{
      background: rgba(37,99,235,.10);
      color: #1d4ed8;
      padding:8px 12px;
      border-radius: 999px;
      font-weight:800;
      font-size:13px;
    }
    .badge.red{
      background: rgba(239,68,68,.10);
      color:#b91c1c;
    }
    .hint{
      color:var(--muted);
      font-size:13px;
    }

    .field{
      position:relative;
      height: 360px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
      border:1px solid rgba(15,23,42,.08);
      overflow:hidden;
    }
    .centerLine{
      position:absolute; left:50%; top:0; bottom:0;
      width:4px;
      transform: translateX(-2px);
      background: repeating-linear-gradient(
        to bottom,
        rgba(15,23,42,.55) 0px,
        rgba(15,23,42,.55) 10px,
        rgba(15,23,42,0) 10px,
        rgba(15,23,42,0) 18px
      );
      opacity:.45;
    }
    .finishL, .finishR{
      position:absolute; top:0; bottom:0;
      width:10px;
      opacity:.22;
    }
    .finishL{left:10%; background: linear-gradient(180deg, rgba(37,99,235,.9), rgba(6,182,212,.5));}
    .finishR{right:10%; background: linear-gradient(180deg, rgba(239,68,68,.9), rgba(239,68,68,.45));}

    .ropeWrap{
      position:absolute;
      left:0; right:0;
      top:50%;
      transform: translateY(-50%);
      height: 120px;
    }
    .rope{
      position:absolute;
      left:50%;
      top:56px;
      transform: translateX(calc(-50% + var(--shift, 0px)));
      width: 520px;
      height: 10px;
      background: linear-gradient(90deg, #b45309, #f59e0b, #b45309);
      border-radius: 999px;
      box-shadow: 0 10px 20px rgba(2,6,23,.15);
      transition: transform .35s ease;
      will-change: transform;
    }
    .knot{
      position:absolute;
      left:50%;
      top:48px;
      transform: translateX(calc(-50% + var(--shift, 0px)));
      width: 30px; height: 26px;
      background: #fbbf24;
      border-radius: 12px;
      border: 2px solid rgba(2,6,23,.15);
      transition: transform .35s ease;
      will-change: transform;
    }

    /* ---- Players (images) ---- */
    .player{
      position:absolute;
      top:18px;
      width:160px;
      height:200px;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      filter: drop-shadow(0 16px 18px rgba(2,6,23,.15));
      transition: transform .35s ease;
    }
    .leftP{ left:8%; transform: translateX(calc(var(--shift, 0px) * .12)); }
    .rightP{ right:8%; transform: translateX(calc(var(--shift, 0px) * .12)); }

    .player small{
      position:absolute;
      bottom:8px;
      font-size:12px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.85);
      border: 1px solid rgba(15,23,42,.10);
      color: var(--text);
    }

    .char{
      width:160px;
      height:200px;
      object-fit: contain;
      transform-origin: 60% 70%;
      will-change: transform;
    }

    /* ---- Running animations ---- */
    .field.running .char{
      animation: pullBody 0.55s ease-in-out infinite;
    }
    .field.running .char.left{
      animation-name: pullBodyLeft;
    }
    .field.running .char.right{
      animation-name: pullBodyRight;
    }
    .field.running .rope{
      animation: ropeShake 0.18s ease-in-out infinite;
    }
    .field.running .knot{
      animation: knotBob 0.25s ease-in-out infinite;
    }

    /* ---- Burst (strong pull) ---- */
    .player.burstL .char{ animation: none; }
    .player.burstR .char{ animation: none; }
    .player.burstL .char{ animation: burstLeft .20s ease-out 1; }
    .player.burstR .char{ animation: burstRight .20s ease-out 1; }

    @keyframes pullBodyLeft{
      0%   { transform: translateX(0) rotate(-2deg) scale(1); }
      50%  { transform: translateX(6px) rotate(2deg)  scale(1.01); }
      100% { transform: translateX(0) rotate(-2deg) scale(1); }
    }
    @keyframes pullBodyRight{
      0%   { transform: translateX(0) rotate(2deg)  scale(1); }
      50%  { transform: translateX(-6px) rotate(-2deg) scale(1.01); }
      100% { transform: translateX(0) rotate(2deg)  scale(1); }
    }
    @keyframes ropeShake{
      0%   { transform: translateX(calc(-50% + var(--shift, 0px))) translateY(0); }
      50%  { transform: translateX(calc(-50% + var(--shift, 0px))) translateY(-1px); }
      100% { transform: translateX(calc(-50% + var(--shift, 0px))) translateY(0); }
    }
    @keyframes knotBob{
      0%   { transform: translateX(calc(-50% + var(--shift, 0px))) translateY(0) scale(1); }
      50%  { transform: translateX(calc(-50% + var(--shift, 0px))) translateY(-2px) scale(1.02); }
      100% { transform: translateX(calc(-50% + var(--shift, 0px))) translateY(0) scale(1); }
    }
    @keyframes burstLeft{
      0%   { transform: translateX(0) rotate(-1deg) scale(1); }
      70%  { transform: translateX(16px) rotate(3deg) scale(1.03); }
      100% { transform: translateX(6px) rotate(1deg) scale(1.01); }
    }
    @keyframes burstRight{
      0%   { transform: translateX(0) rotate(1deg) scale(1); }
      70%  { transform: translateX(-16px) rotate(-3deg) scale(1.03); }
      100% { transform: translateX(-6px) rotate(-1deg) scale(1.01); }
    }

    .toast{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(15,23,42,.10);
      color: var(--muted);
      font-size:13px;
      min-height:42px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: rgba(100,116,139,.45);
    }
    .dot.ok{background: rgba(34,197,94,.8)}
    .dot.bad{background: rgba(239,68,68,.8)}

    /* Quiz panels */
    .sideTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:10px;
    }
    .sideTitle h3{
      margin:0; font-size:16px;
    }
    .score{
      font-weight:900;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(15,23,42,.12);
      background: rgba(248,250,252,.9);
      min-width:88px;
      text-align:center;
    }
    .qbox{
      background: rgba(248,250,252,.9);
      border:1px solid rgba(15,23,42,.08);
      border-radius: 16px;
      padding:12px;
      font-weight:800;
      min-height: 86px;
      display:flex;
      align-items:center;
    }
    pre{
      margin:0;
      width:100%;
      white-space:pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size:13px;
      line-height:1.3;
    }
    .choices{
      margin-top:10px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .choiceBtn{
      text-align:left;
      padding:12px 12px;
      border-radius: 16px;
      border:1px solid rgba(15,23,42,.12);
      background:white;
      cursor:pointer;
      font-weight:700;
      transition:.12s transform, .12s border-color;
    }
    .choiceBtn:hover{transform: translateY(-1px); border-color: rgba(37,99,235,.35)}
    .choiceBtn:disabled{opacity:.55; cursor:not-allowed; transform:none;}
    .choiceBtn .lab{
      font-weight:900;
      margin-right:8px;
      color: rgba(15,23,42,.65);
    }
    .panelFooter{
      margin-top:12px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .tiny{
      font-size:12px; color:var(--muted);
    }

    /* Winner overlay */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(2,6,23,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:10;
      padding:16px;
    }
    .modal{
      width:min(680px, 100%);
      background:white;
      border-radius: 26px;
      box-shadow: 0 30px 70px rgba(2,6,23,.35);
      padding:18px;
      border: 1px solid rgba(255,255,255,.25);
    }
    .modal h2{margin:0 0 6px 0}
    .modal p{margin:0 0 14px 0; color:var(--muted)}
    .modal .actions{display:flex; gap:10px; flex-wrap:wrap}
  </style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>Python Tug-of-War <span style="opacity:.5">‚Ä¢</span> Quiz</div>
    </div>
    <div class="pill">
      <span>–†–∞—É–Ω–¥: <b id="roundNow">1</b>/<b id="roundMax">10</b></span>
      <span>“ö–∞–¥–∞–º: <b id="stepNow">0</b>/<b id="stepWin">7</b></span>
    </div>
    <div style="display:flex; gap:10px; align-items:center;">
      <button class="btn secondary" id="btnReset">“ö–∞–π—Ç–∞ –±–∞—Å—Ç–∞—É</button>
      <button class="btn" id="btnStart">–ë–∞—Å—Ç–∞—É</button>
    </div>
  </div>
</header>

<main>
  <!-- Left panel -->
  <section class="card" id="leftPanel">
    <div class="sideTitle">
      <h3>–ö”©–∫ —Ç–æ–ø</h3>
      <div class="score" id="scoreL">0</div>
    </div>
    <div class="qbox"><pre id="qL">–ë–∞—Å—Ç–∞—É –±–∞—Å!</pre></div>
    <div class="choices" id="choicesL"></div>
    <div class="panelFooter">
      <div class="tiny">–ñ–∞—É–∞–ø—Ç—ã —Ç–∞“£–¥–∞ ‚Äî –±”ô—Ä—ñ –∞–≤—Ç–æ–º–∞—Ç üòÑ</div>
    </div>
  </section>

  <!-- Center arena -->
  <section class="card arena">
    <div class="arenaTop">
      <span class="badge">–û–π—ã–Ω: –ê—Ä“õ–∞–Ω —Ç–∞—Ä—Ç—É</span>
      <span class="hint">–ï–∫—ñ –∂–∞“õ —Ç–∞ –∂–∞—É–∞–ø –±–µ—Ä–µ–¥—ñ. –î“±—Ä—ã—Å –∂–∞—É–∞–ø ‚Äî –∞—Ä“õ–∞–Ω ”©–∑—ñ–Ω–µ —Ç–∞—Ä—Ç—ã–ª–∞–¥—ã.</span>
      <span class="badge red">Python —Ç–µ—Å—Ç</span>
    </div>

    <div class="field" id="field">
      <div class="finishL" title="–ú”ô—Ä–µ"></div>
      <div class="finishR" title="–ú”ô—Ä–µ"></div>
      <div class="centerLine"></div>

      <div class="ropeWrap">
        <div class="rope" id="rope"></div>
        <div class="knot" id="knot"></div>
      </div>

      <!-- CHARACTERS (replace images in assets folder) -->
      <div class="player leftP" id="pL">
        <img class="char left" src="img/left.png" alt="–ö”©–∫ –∫–µ–π—ñ–ø–∫–µ—Ä">
        <small>–ö”©–∫</small>
      </div>

      <div class="player rightP" id="pR">
        <img class="char right" src="img/right.png" alt="“ö—ã–∑—ã–ª –∫–µ–π—ñ–ø–∫–µ—Ä">
        <small>“ö—ã–∑—ã–ª</small>
      </div>
    </div>

    <div class="toast" id="toast">
      <span class="dot" id="toastDot"></span>
      <span id="toastText">–î–∞–π—ã–Ω. ‚Äú–ë–∞—Å—Ç–∞—É‚Äù –±–∞—Å.</span>
    </div>
  </section>

  <!-- Right panel -->
  <section class="card" id="rightPanel">
    <div class="sideTitle">
      <h3>“ö—ã–∑—ã–ª —Ç–æ–ø</h3>
      <div class="score" id="scoreR">0</div>
    </div>
    <div class="qbox"><pre id="qR">–ë–∞—Å—Ç–∞—É –±–∞—Å!</pre></div>
    <div class="choices" id="choicesR"></div>
    <div class="panelFooter">
      <div class="tiny">“ö–∞—Ç–µ –±–æ–ª—Å–∞ ‚Äî “õ–∞—Ä—Å—ã –∂–∞“õ “õ—É–∞–Ω—ã–ø –∫–µ—Ç–µ–¥—ñ üòÖ</div>
    </div>
  </section>
</main>

<!-- Winner overlay -->
<div class="overlay" id="overlay">
  <div class="modal">
    <h2 id="winTitle">–û–π—ã–Ω –∞—è“õ—Ç–∞–ª–¥—ã!</h2>
    <p id="winDesc">–ñ–µ“£—ñ–º–ø–∞–∑: ...</p>
    <div class="actions">
      <button class="btn" id="btnPlayAgain">“ö–∞–π—Ç–∞ –æ–π–Ω–∞—É</button>
      <button class="btn secondary" id="btnClose">–ñ–∞–±—É</button>
    </div>
  </div>
</div>

<script>
/* =======================
   PYTHON QUIZ POOL
   ======================= */
const QUESTION_POOL = [
  { prompt: `print(type(3))`, options: ["<class 'int'>","<class 'str'>","<class 'float'>","<class 'bool'>"], answerIndex: 0 },
  { prompt: `s = "–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞"\nprint(s[2:7])`, options: ["—Ñ–æ—Ä–º–∞","—Ñ–æ—Ä–º","–Ω—Ñ–æ—Ä","—Ä–º–∞—Ç–∏"], answerIndex: 2 },
  { prompt: `a = [1,2,3]\na.append(4)\nprint(a)`, options: ["[1,2,3]","[1,2,3,4]","[4,1,2,3]","“ö–∞—Ç–µ —à—ã“ì–∞–¥—ã"], answerIndex: 1 },
  { prompt: `print(7//2)`, options: ["3","3.5","4","“ö–∞—Ç–µ"], answerIndex: 0 },
  { prompt: `x = 5\nx += 2\nprint(x)`, options: ["5","7","2","52"], answerIndex: 1 },
  { prompt: `print("py"*3)`, options: ["py3","pypypy","py py py","“ö–∞—Ç–µ"], answerIndex: 1 },
  { prompt: `a = [3,1,2]\nprint(sorted(a))`, options: ["[3,1,2]","[1,2,3]","[2,1,3]","“ö–∞—Ç–µ"], answerIndex: 1 },
  { prompt: `print(bool(0))`, options: ["True","False","0","“ö–∞—Ç–µ"], answerIndex: 1 },
  { prompt: `s="abc"\nprint(s.upper())`, options: ["ABC","abc","Abc","“ö–∞—Ç–µ"], answerIndex: 0 },
  { prompt: `for i in range(2,6,2):\n    print(i, end=" ")`, options: ["2 3 4 5","2 4 6","2 4","4 6"], answerIndex: 2 },
  { prompt: `d = {"a":1, "b":2}\nprint(d["b"])`, options: ["1","2","b","“ö–∞—Ç–µ"], answerIndex: 1 },
  { prompt: `print(len([0,1,2,3]))`, options: ["3","4","5","“ö–∞—Ç–µ"], answerIndex: 1 },
];

/* =======================
   GAME SETTINGS
   ======================= */
const TOTAL_ROUNDS_DEFAULT = 10;
const STEP_TO_WIN_DEFAULT = 7;
const SHIFT_PER_STEP = 26;

let started = false;
let locked = false;

let totalRounds = TOTAL_ROUNDS_DEFAULT;
let stepToWin = STEP_TO_WIN_DEFAULT;

let round = 1;
let scoreL = 0;
let scoreR = 0;

let pull = 0; // negative => left leading, positive => right leading

let currentL = null;
let currentR = null;

const $ = (id) => document.getElementById(id);

function pickQuestion(excludePrompt=null){
  const pool = QUESTION_POOL.filter(q => q.prompt !== excludePrompt);
  const q = pool[Math.floor(Math.random()*pool.length)];
  return JSON.parse(JSON.stringify(q));
}

function setToast(type, text){
  const dot = $("toastDot");
  dot.className = "dot" + (type==="ok" ? " ok" : type==="bad" ? " bad" : "");
  $("toastText").textContent = text;
}

function updateHUD(){
  $("roundNow").textContent = String(round);
  $("roundMax").textContent = String(totalRounds);
  $("scoreL").textContent = String(scoreL);
  $("scoreR").textContent = String(scoreR);

  $("stepNow").textContent = String(Math.min(Math.abs(pull), stepToWin));
  $("stepWin").textContent = String(stepToWin);

  const shiftPx = pull * SHIFT_PER_STEP;
  $("rope").style.setProperty("--shift", `${shiftPx}px`);
  $("knot").style.setProperty("--shift", `${shiftPx}px`);
  $("pL").style.setProperty("--shift", `${shiftPx}px`);
  $("pR").style.setProperty("--shift", `${shiftPx}px`);
}

function renderQuestion(side, q){
  const qEl = side==="L" ? $("qL") : $("qR");
  const cEl = side==="L" ? $("choicesL") : $("choicesR");
  qEl.textContent = q.prompt;

  cEl.innerHTML = "";
  const labels = ["A","B","C","D"];

  q.options.forEach((opt, idx)=>{
    const btn = document.createElement("button");
    btn.className = "choiceBtn";
    btn.innerHTML = `<span class="lab">${labels[idx]})</span> ${opt}`;
    btn.onclick = ()=> onAnswer(side, idx);
    cEl.appendChild(btn);
  });
}

function disableChoices(disabled=true){
  ["choicesL","choicesR"].forEach(id=>{
    $(id).querySelectorAll("button").forEach(b=> b.disabled = disabled);
  });
}

function newRound(){
  currentL = pickQuestion();
  currentR = pickQuestion(currentL.prompt);

  renderQuestion("L", currentL);
  renderQuestion("R", currentR);

  setToast("neutral", `–†–∞—É–Ω–¥ ${round}/${totalRounds}. –ï–∫—ñ —Ç–æ–ø —Ç–∞ –∂–∞—É–∞–ø –±–µ—Ä—Å—ñ–Ω!`);
  disableChoices(false);
  locked = false;
  updateHUD();
}

let answeredL = false;
let answeredR = false;
let correctL = false;
let correctR = false;

function burst(side){
  const el = side==="L" ? $("pL") : $("pR");
  el.classList.remove("burstL","burstR");
  void el.offsetWidth; // restart animation
  el.classList.add(side==="L" ? "burstL" : "burstR");
  setTimeout(()=> el.classList.remove("burstL","burstR"), 260);
}

function onAnswer(side, chosenIndex){
  if(!started || locked) return;

  const containerId = side==="L" ? "choicesL" : "choicesR";
  $(containerId).querySelectorAll("button").forEach(b=> b.disabled = true);

  if(side==="L"){
    answeredL = true;
    correctL = (chosenIndex === currentL.answerIndex);
  }else{
    answeredR = true;
    correctR = (chosenIndex === currentR.answerIndex);
  }

  if(answeredL && answeredR){
    resolveRound();
  }else{
    setToast("neutral", `–ï–∫—ñ–Ω—à—ñ —Ç–æ–ø—Ç—ã“£ –∂–∞—É–∞–±—ã–Ω –∫“Ø—Ç–µ–º—ñ–∑‚Ä¶`);
  }
}

function resolveRound(){
  locked = true;

  if(correctL) scoreL++;
  if(correctR) scoreR++;

  let delta = 0; // negative => left pulls, positive => right pulls
  if(correctL && !correctR) delta = -1;
  if(!correctL && correctR) delta = +1;

  pull += delta;

  if(delta === 0){
    if(correctL && correctR){
      setToast("ok", "–ï–∫—ñ —Ç–æ–ø —Ç–∞ –¥“±—Ä—ã—Å! –ê—Ä“õ–∞–Ω “õ–æ–∑“ì–∞–ª–º–∞–π–¥—ã, –±—ñ—Ä–∞“õ “±–ø–∞–π “õ–æ—Å—ã–ª–¥—ã ‚úÖ‚úÖ");
      burst("L"); burst("R");
    }else{
      setToast("bad", "–ï–∫—ñ —Ç–æ–ø —Ç–∞ “õ–∞—Ç–µ‚Ä¶ –ê—Ä“õ–∞–Ω –¥–∞ —Ä–µ–Ω–∂—ñ–¥—ñ üòÖ");
    }
  }else if(delta < 0){
    setToast("ok", "–ö”©–∫ —Ç–æ–ø –¥“±—Ä—ã—Å! –ê—Ä“õ–∞–Ω –∫”©–∫ –∂–∞“õ“õ–∞ —Ç–∞—Ä—Ç—ã–ª–¥—ã üîµ");
    burst("L");
  }else{
    setToast("ok", "“ö—ã–∑—ã–ª —Ç–æ–ø –¥“±—Ä—ã—Å! –ê—Ä“õ–∞–Ω “õ—ã–∑—ã–ª –∂–∞“õ“õ–∞ —Ç–∞—Ä—Ç—ã–ª–¥—ã üî¥");
    burst("R");
  }

  updateHUD();

  if(Math.abs(pull) >= stepToWin){
    endGame(pull < 0 ? "–ö”©–∫ —Ç–æ–ø" : "“ö—ã–∑—ã–ª —Ç–æ–ø");
    return;
  }

  round++;
  if(round > totalRounds){
    let winner = "–¢–µ“£!";
    if(pull < 0) winner = "–ö”©–∫ —Ç–æ–ø";
    else if(pull > 0) winner = "“ö—ã–∑—ã–ª —Ç–æ–ø";
    else {
      if(scoreL > scoreR) winner = "–ö”©–∫ —Ç–æ–ø";
      else if(scoreR > scoreL) winner = "“ö—ã–∑—ã–ª —Ç–æ–ø";
    }
    endGame(winner, true);
    return;
  }

  setTimeout(()=>{
    answeredL = answeredR = false;
    correctL = correctR = false;
    newRound();
  }, 650);
}

function endGame(winner, byRounds=false){
  disableChoices(true);
  started = false;

  $("field").classList.remove("running"); // stop pulling animation

  const title = byRounds ? "–†–∞—É–Ω–¥—Ç–∞—Ä –±—ñ—Ç—Ç—ñ!" : "–û–π—ã–Ω –∞—è“õ—Ç–∞–ª–¥—ã! üèÅ";
  $("winTitle").textContent = title;

  let desc = `–ñ–µ“£—ñ–º–ø–∞–∑: ${winner}. “∞–ø–∞–π: –ö”©–∫=${scoreL}, “ö—ã–∑—ã–ª=${scoreR}.`;
  desc += byRounds ? ` –ê—Ä“õ–∞–Ω –ø–æ–∑–∏—Ü–∏—è—Å—ã: ${pull}.` : ` –ê—Ä“õ–∞–Ω –±–∞“ì—ã—Ç—ã: ${pull<0 ? "–ö”©–∫" : "“ö—ã–∑—ã–ª"} –∂–∞“õ—Ç–∞.`;
  $("winDesc").textContent = desc;

  $("overlay").style.display = "flex";
}

function resetGame(){
  started = false;
  locked = false;

  round = 1;
  scoreL = 0;
  scoreR = 0;
  pull = 0;

  answeredL = answeredR = false;
  correctL = correctR = false;

  $("field").classList.remove("running"); // stop animation

  $("qL").textContent = "–ë–∞—Å—Ç–∞—É –±–∞—Å!";
  $("qR").textContent = "–ë–∞—Å—Ç–∞—É –±–∞—Å!";
  $("choicesL").innerHTML = "";
  $("choicesR").innerHTML = "";

  setToast("neutral", "–î–∞–π—ã–Ω. ‚Äú–ë–∞—Å—Ç–∞—É‚Äù –±–∞—Å.");
  updateHUD();
}

function startGame(){
  if(started) return;
  started = true;

  totalRounds = TOTAL_ROUNDS_DEFAULT;
  stepToWin = STEP_TO_WIN_DEFAULT;

  $("overlay").style.display = "none";
  $("field").classList.add("running"); // start pulling animation

  round = 1;
  scoreL = 0;
  scoreR = 0;
  pull = 0;

  answeredL = answeredR = false;
  correctL = correctR = false;

  setToast("neutral", "–û–π—ã–Ω –±–∞—Å—Ç–∞–ª–¥—ã! –ï–∫—ñ —Ç–æ–ø —Ç–∞ –∂–∞—É–∞–ø –±–µ—Ä—Å—ñ–Ω!");
  updateHUD();
  newRound();
}

/* buttons */
$("btnStart").addEventListener("click", startGame);
$("btnReset").addEventListener("click", resetGame);
$("btnPlayAgain").addEventListener("click", ()=>{ $("overlay").style.display="none"; startGame(); });
$("btnClose").addEventListener("click", ()=>{ $("overlay").style.display="none"; });

resetGame();
</script>
</body>
</html>
