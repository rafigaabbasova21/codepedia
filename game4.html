
<!doctype html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–†–µ—Ñ–ª–µ–∫—Å–∏—è</title>
  <style>
    :root{
      --bg1:#7c3aed; --bg2:#06b6d4; --bg3:#22c55e; --bg4:#f59e0b;
      --panel: rgba(255,255,255,.86);
      --stroke: rgba(15,23,42,.10);
      --text:#0f172a;
      --muted:#475569;
      --shadow: 0 22px 70px rgba(15,23,42,.18);
      --r: 28px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color:var(--text);
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(255,255,255,.45), transparent 60%),
        radial-gradient(900px 650px at 85% 20%, rgba(255,255,255,.35), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2) 35%, var(--bg3) 70%, var(--bg4));
    }

    /* floating blobs */
    .blob{
      position:fixed;
      width: 560px;
      height: 560px;
      border-radius: 999px;
      filter: blur(18px);
      opacity:.35;
      z-index:0;
      mix-blend-mode: soft-light;
      animation: drift 14s ease-in-out infinite;
    }
    .bA{left:-160px; top:-140px; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.9), rgba(124,58,237,.0) 55%), radial-gradient(circle at 60% 70%, rgba(6,182,212,.9), rgba(6,182,212,.0) 60%);}
    .bB{right:-180px; top:20px; background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.9), rgba(34,197,94,.0) 55%), radial-gradient(circle at 70% 65%, rgba(245,158,11,.9), rgba(245,158,11,.0) 60%); animation-duration: 16s;}
    .bC{left:20%; bottom:-220px; background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.9), rgba(59,130,246,.0) 55%), radial-gradient(circle at 70% 65%, rgba(168,85,247,.9), rgba(168,85,247,.0) 60%); animation-duration: 18s;}
    @keyframes drift{
      0%{transform: translate(0,0) scale(1);}
      50%{transform: translate(40px, -30px) scale(1.04);}
      100%{transform: translate(0,0) scale(1);}
    }

    .wrap{
      position:relative;
      z-index:2;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
    }

    .board{
      width:min(1120px, 96vw);
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 10px 14px;
      border-bottom: 1px solid rgba(15,23,42,.08);
      margin-bottom: 14px;
    }
    .ttl{
      font-weight:1000;
      letter-spacing:.2px;
      font-size: 18px;
    }
    .sub{
      color: var(--muted);
      font-weight: 800;
      font-size: 12.5px;
      margin-top:2px;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .chip{
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.70);
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 1000;
      cursor:pointer;
      box-shadow: 0 12px 30px rgba(15,23,42,.10);
      transition: .18s transform, .18s filter;
      user-select:none;
    }
    .chip:hover{transform: translateY(-1px); filter:brightness(1.03);}
    .chip:active{transform: translateY(0px) scale(.99);}
    .chip.red{background: rgba(239,68,68,.14); border-color: rgba(239,68,68,.22);}
    .chip.green{background: rgba(34,197,94,.14); border-color: rgba(34,197,94,.22);}

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    @media (max-width: 950px){
      .grid{grid-template-columns:1fr;}
      .top{align-items:flex-start;}
    }

    .card{
      border:0;
      border-radius: 26px;
      cursor:pointer;
      min-height: 220px;
      padding: 18px;
      box-shadow: 0 18px 55px rgba(15,23,42,.15);
      transition: transform .18s ease, filter .18s ease, box-shadow .18s ease;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 16px;
      user-select:none;
      overflow:hidden;
      isolation:isolate;
    }
    .card:hover{transform: translateY(-3px); filter:brightness(1.02); box-shadow: 0 24px 70px rgba(15,23,42,.18);}
    .card:active{transform: translateY(0px) scale(.995);}

    .shine{
      position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 45%);
      transform: rotate(18deg);
      opacity:.55;
      animation: shine 5.2s ease-in-out infinite;
      z-index:0;
    }
    @keyframes shine{
      0%{transform: translate(-2%, -2%) rotate(18deg);}
      50%{transform: translate(2%, 2%) rotate(18deg);}
      100%{transform: translate(-2%, -2%) rotate(18deg);}
    }

    .b1{background: linear-gradient(135deg, #22c55e, #06b6d4);}
    .b2{background: linear-gradient(135deg, #f59e0b, #fb7185);}
    .b3{background: linear-gradient(135deg, #3b82f6, #a855f7);}

    .content{
      position:relative;
      z-index:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 12px;
      text-align:center;
    }

    .thumb{
      width: 92px; height: 92px;
      border-radius: 22px;
      border: 2px solid rgba(255,255,255,.45);
      background: rgba(255,255,255,.16);
      backdrop-filter: blur(7px);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      transform: translateZ(0);
    }
    .thumb img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1);
      transition: transform .22s ease;
    }
    .card:hover .thumb img{transform: scale(1.08);}

    .label{
      font-weight:1000;
      font-size: clamp(24px, 2.6vw, 34px);
      letter-spacing:.2px;
      color:#0f172a;
      text-shadow: 0 2px 0 rgba(255,255,255,.25);
    }

    .counter{
      position:absolute;
      top: 14px; right: 14px;
      width: 52px; height: 52px;
      border-radius: 999px;
      background: rgba(255,255,255,.88);
      border: 1px solid rgba(15,23,42,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      font-size: 20px;
      box-shadow: 0 14px 34px rgba(15,23,42,.12);
      z-index:2;
    }
    .counter.pop{animation: pop .34s ease both;}
    @keyframes pop{
      0%{transform: scale(.9); opacity:.2;}
      70%{transform: scale(1.16); opacity:1;}
      100%{transform: scale(1);}
    }

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(2,6,23,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 30;
    }
    .overlay.show{display:flex;}
    .modal{
      width:min(980px, 98vw);
      border-radius: 30px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(15,23,42,.10);
      box-shadow: 0 34px 110px rgba(0,0,0,.28);
      overflow:hidden;
      transform: translateY(10px) scale(.99);
      opacity:0;
      animation: modalIn .22s ease forwards;
    }
    @keyframes modalIn{
      to{transform: translateY(0) scale(1); opacity:1;}
    }
    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 14px;
      background: rgba(255,255,255,.70);
      border-bottom: 1px solid rgba(15,23,42,.08);
    }
    .mTitle{font-weight:1000;}
    .close{
      border:0;
      background: rgba(15,23,42,.08);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 1000;
    }
    .modalBody{padding: 14px;}
    .bigPhoto{
      width: min(760px, 96vw);
      aspect-ratio: 16/10;
      margin: 0 auto;
      border-radius: 24px;
      background: rgba(255,255,255,.82);
      border: 2px dashed rgba(15,23,42,.20);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .bigPhoto img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }
    .hint{
      text-align:center;
      margin: 10px 0 0;
      font-weight:900;
      color: rgba(15,23,42,.65);
      font-size: 13px;
    }

    /* Tiny confetti */
    #fx{position:fixed; inset:0; pointer-events:none; z-index:25;}
  </style>
</head>
<body>
  <div class="blob bA"></div>
  <div class="blob bB"></div>
  <div class="blob bC"></div>
  <canvas id="fx"></canvas>

  <div class="wrap">
    <div class="board">
      <div class="top">
        <div>
          <div class="ttl">–†–µ—Ñ–ª–µ–∫—Å–∏—è</div>
          
        <div class="controls">
          <button class="chip green" id="undoBtn">‚Ü©Ô∏è –ê—Ä—Ç“õ–∞</button>
          <button class="chip red" id="resetBtn">üóëÔ∏è ”®—à—ñ—Ä—É</button>
        </div>
      </div>

      <div class="grid">
        <button class="card b1" id="btnOk">
          <div class="shine"></div>
          <div class="counter" id="cOk">0</div>
          <div class="content">
            <div class="thumb"><img src="./refimg/1.jpeg" alt="–¢“Ø—Å—ñ–Ω–¥—ñ–º"></div>
            <div class="label">–¢“Ø—Å—ñ–Ω–¥—ñ–º</div>
          </div>
        </button>

        <button class="card b2" id="btnQ">
          <div class="shine"></div>
          <div class="counter" id="cQ">0</div>
          <div class="content">
            <div class="thumb"><img src="./refimg/2.jpeg" alt="–°“±—Ä–∞“ì—ã–º –±–∞—Ä"></div>
            <div class="label">–°“±—Ä–∞“ì—ã–º –±–∞—Ä</div>
          </div>
        </button>

        <button class="card b3" id="btnNo">
          <div class="shine"></div>
          <div class="counter" id="cNo">0</div>
          <div class="content">
            <div class="thumb"><img src="./refimg/3.jpeg" alt="–¢“Ø—Å—ñ–Ω–±–µ–¥—ñ–º"></div>
            <div class="label">–¢“Ø—Å—ñ–Ω–±–µ–¥—ñ–º</div>
          </div>
        </button>
      </div>
    </div>
  </div>

  <div class="overlay" id="ov">
    <div class="modal">
      <div class="modalTop">
        <div class="mTitle" id="mTitle">...</div>
        <button class="close" id="mClose">‚úñ</button>
      </div>
      <div class="modalBody">
        <div class="bigPhoto" id="bigPhoto">
          <img id="mImg" src="" alt="">
        </div>
        <div class="hint" id="mHint"></div>
      </div>
    </div>
  </div>

  <script>
    // ===== storage =====
    const KEY = "reflex_anim_v2";
    const $ = (s)=>document.querySelector(s);

    const state = (() => {
      try { return JSON.parse(localStorage.getItem(KEY)) || {ok:0,q:0,no:0, hist:[]}; }
      catch(e){ return {ok:0,q:0,no:0, hist:[]}; }
    })();

    const cOk=$("#cOk"), cQ=$("#cQ"), cNo=$("#cNo");
    const ov=$("#ov"), mTitle=$("#mTitle"), mHint=$("#mHint"), bigPhoto=$("#bigPhoto");
    let mImg=$("#mImg");

    // –ú–µ–º–¥–µ—Ä refimg —ñ—à—ñ–Ω–¥–µ 4.jpeg-—Ç–µ–Ω –±–∞—Å—Ç–∞–ª–∞–¥—ã
    const MEME_START = 4;
    const MEME_END   = 13; // —Å–µ–Ω–¥–µ 13.jpeg-–∫–µ –¥–µ–π—ñ–Ω –±–∞—Ä —Å–∏—è“õ—Ç—ã (”©–∑–≥–µ—Ä—Ç–µ —Å–∞–ª)

    function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
    function paint(){
      cOk.textContent = state.ok;
      cQ.textContent  = state.q;
      cNo.textContent = state.no;
    }
    function popCounter(el){
      el.classList.remove("pop");
      void el.offsetWidth;
      el.classList.add("pop");
    }

    function closeModal(){ ov.classList.remove("show"); }

    function ensureImgMode(){
      // –º–∏–∫—Ä–æ—Ñ–æ–Ω —Ä–µ–∂–∏–º—ñ–Ω–µ–Ω –∫–µ–π—ñ–Ω “õ–∞–π—Ç–∞–¥–∞–Ω img —Ä–µ–∂–∏–º—ñ–Ω “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä–µ–º—ñ–∑
      if(bigPhoto.querySelector("#mImg")) return;
      bigPhoto.innerHTML = `<img id="mImg" src="" alt="">`;
      mImg = $("#mImg");
    }

    function openMeme(){
      ensureImgMode();
      const span = MEME_END - MEME_START + 1;
      const idx = (state.ok - 1) % span; // state.ok –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—Ç–µ–Ω –∫–µ–π—ñ–Ω
      const num = MEME_START + idx;

      mTitle.textContent = "–¢“Ø—Å—ñ–Ω–¥—ñ–º üòé";
      mHint.textContent = "";
      mImg.style.display = "block";
      mImg.src = `./refimg/${num}.jpeg`;
      mImg.alt = `meme ${num}`;
      ov.classList.add("show");
    }

    function openMic(){
      // üé§ “ì–∞–Ω–∞
      bigPhoto.innerHTML = `
        <div style="
          font-size:86px; line-height:1;
          filter: drop-shadow(0 10px 20px rgba(15,23,42,.18));
        ">üé§</div>
      `;
      mTitle.textContent = "–°“±—Ä–∞“ì—ã–º –±–∞—Ä üé§";
      mHint.textContent = "";
      ov.classList.add("show");
    }

    // ===== tiny confetti =====
    const fx=$("#fx"), ctx=fx.getContext("2d");
    let W=0,H=0, parts=[], raf=null;

    function resize(){
      W = fx.width = window.innerWidth;
      H = fx.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    function burst(){
      const x = W/2, y = H/2;
      for(let i=0;i<90;i++){
        parts.push({
          x, y,
          vx:(Math.random()*2-1)*(3+Math.random()*4),
          vy:(Math.random()*2-1)*(3+Math.random()*4)-2.5,
          r: 2+Math.random()*4,
          life: 55+Math.random()*35,
          rot: Math.random()*Math.PI,
          vr:(Math.random()*2-1)*0.2,
          hue: Math.floor(Math.random()*360)
        });
      }
      if(!raf) loop();
    }
    function loop(){
      raf=requestAnimationFrame(loop);
      ctx.clearRect(0,0,W,H);
      for(let i=parts.length-1;i>=0;i--){
        const p=parts[i];
        p.life-=1;
        p.vy+=0.12;
        p.x+=p.vx;
        p.y+=p.vy;
        p.rot+=p.vr;

        const a = Math.max(0, Math.min(1, p.life/60));
        ctx.save();
        ctx.globalAlpha=a;
        ctx.translate(p.x,p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle=`hsl(${p.hue}, 90%, 60%)`;
        ctx.fillRect(-p.r, -p.r, p.r*2.2, p.r*1.2);
        ctx.restore();

        if(p.life<=0 || p.y>H+60) parts.splice(i,1);
      }
      if(parts.length===0){ cancelAnimationFrame(raf); raf=null; }
    }

    // ===== actions =====
    $("#btnOk").addEventListener("click", ()=>{
      state.ok++; state.hist.push("ok"); save(); paint();
      popCounter(cOk); burst();
      openMeme(); // ‚úÖ ”ô—Ä –±–∞—Å“õ–∞–Ω–¥–∞ ”ô—Ä –±–∞—Å“õ–∞ –º–µ–º
    });

    $("#btnQ").addEventListener("click", ()=>{
      state.q++; state.hist.push("q"); save(); paint();
      popCounter(cQ); burst();
      openMic(); // ‚úÖ —Ç–µ–∫ üé§
    });

    $("#btnNo").addEventListener("click", ()=>{
      state.no++; state.hist.push("no"); save(); paint();
      popCounter(cNo); burst();
      // ‚úÖ –µ—à—Ç–µ“£–µ —à—ã“õ–ø–∞–π–¥—ã
    });

    $("#undoBtn").addEventListener("click", ()=>{
      const last = state.hist.pop();
      if(!last) return;
      if(last==="ok" && state.ok>0) state.ok--;
      if(last==="q"  && state.q>0)  state.q--;
      if(last==="no" && state.no>0) state.no--;
      save(); paint();
      if(last==="ok") popCounter(cOk);
      if(last==="q")  popCounter(cQ);
      if(last==="no") popCounter(cNo);
    });

    $("#resetBtn").addEventListener("click", ()=>{
      state.ok=0; state.q=0; state.no=0; state.hist=[];
      save(); paint();
      closeModal();
    });

    $("#mClose").addEventListener("click", closeModal);
    ov.addEventListener("click", (e)=>{ if(e.target===ov) closeModal(); });
    document.addEventListener("keydown",(e)=>{ if(e.key==="Escape") closeModal(); });

    paint();
  </script>
</body>
</html>

